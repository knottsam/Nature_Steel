[debug] [2026-01-05T18:41:31.138Z] ----------------------------------------------------------------------
[debug] [2026-01-05T18:41:31.140Z] Command:       C:\Program Files\nodejs\node.exe C:\Users\Sam\AppData\Roaming\npm\node_modules\firebase-tools\lib\bin\firebase.js functions:shell
[debug] [2026-01-05T18:41:31.140Z] CLI Version:   14.22.0
[debug] [2026-01-05T18:41:31.140Z] Platform:      win32
[debug] [2026-01-05T18:41:31.141Z] Node Version:  v22.14.0
[debug] [2026-01-05T18:41:31.141Z] Time:          Mon Jan 05 2026 18:41:31 GMT+0000 (Greenwich Mean Time)
[debug] [2026-01-05T18:41:31.141Z] ----------------------------------------------------------------------
[debug] 
[debug] [2026-01-05T18:41:31.326Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2026-01-05T18:41:31.326Z] > authorizing via signed-in user (knott.mail8@gmail.com)
[debug] [2026-01-05T18:41:31.326Z] [iam] checking project nature-and-steel for permissions ["firebase.projects.get"]
[debug] [2026-01-05T18:41:31.327Z] Checked if tokens are valid: true, expires at: 1767641917478
[debug] [2026-01-05T18:41:31.327Z] Checked if tokens are valid: true, expires at: 1767641917478
[debug] [2026-01-05T18:41:31.328Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/nature-and-steel:testIamPermissions [none]
[debug] [2026-01-05T18:41:31.328Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/nature-and-steel:testIamPermissions x-goog-quota-user=projects/nature-and-steel
[debug] [2026-01-05T18:41:31.328Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/nature-and-steel:testIamPermissions {"permissions":["firebase.projects.get"]}
[debug] [2026-01-05T18:41:31.989Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/nature-and-steel:testIamPermissions 200
[debug] [2026-01-05T18:41:31.990Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/nature-and-steel:testIamPermissions {"permissions":["firebase.projects.get"]}
[debug] [2026-01-05T18:41:31.990Z] Emulator locator file path: C:\Users\Sam\AppData\Local\Temp\hub-nature-and-steel.json
[debug] [2026-01-05T18:41:31.994Z] [functions] Functions Emulator only supports listening on one address (127.0.0.1). Not listening on ::1
[debug] [2026-01-05T18:41:32.019Z] defaultcredentials: writing to file C:\Users\Sam\AppData\Roaming\firebase\knott_mail8_gmail.com_application_default_credentials.json
[debug] [2026-01-05T18:41:32.021Z] DEBUG: Setting GAC to C:\Users\Sam\AppData\Roaming\firebase\knott_mail8_gmail.com_application_default_credentials.json
[debug] [2026-01-05T18:41:32.021Z] Checked if tokens are valid: true, expires at: 1767641917478
[debug] [2026-01-05T18:41:32.021Z] Checked if tokens are valid: true, expires at: 1767641917478
[debug] [2026-01-05T18:41:32.021Z] >>> [apiv2][query] GET https://firebase.googleapis.com/v1beta1/projects/nature-and-steel/adminSdkConfig [none]
[debug] [2026-01-05T18:41:32.695Z] <<< [apiv2][status] GET https://firebase.googleapis.com/v1beta1/projects/nature-and-steel/adminSdkConfig 200
[debug] [2026-01-05T18:41:32.695Z] <<< [apiv2][body] GET https://firebase.googleapis.com/v1beta1/projects/nature-and-steel/adminSdkConfig {"projectId":"nature-and-steel","storageBucket":"nature-and-steel.firebasestorage.app"}
[debug] [2026-01-05T18:41:32.721Z] [functions] Watching "C:\Users\Sam\Nature_Steel\Nature_Steel\functions" for Cloud Functions...
[debug] [2026-01-05T18:41:32.727Z] Validating nodejs source
[debug] [2026-01-05T18:41:33.525Z] > [functions] package.json contents: {
  "name": "functions",
  "description": "Cloud Functions for Firebase",
  "scripts": {
    "lint": "eslint .",
    "serve": "firebase emulators:start --only functions",
    "shell": "firebase functions:shell",
    "start": "npm run shell",
    "deploy": "firebase deploy --only functions",
    "logs": "firebase functions:log",
    "test": "node --test"
  },
  "engines": {
    "node": "20"
  },
  "main": "index.js",
  "dependencies": {
    "dotenv": "^16.4.5",
    "firebase-admin": "^12.6.0",
    "firebase-functions": "^7.0.2",
    "graff-furniture-vite": "file:..",
    "square": "^43.2.0",
    "stripe": "^18.5.0"
  },
  "devDependencies": {
    "eslint": "^8.15.0",
    "eslint-config-google": "^0.14.0",
    "eslint-plugin-jsdoc": "^61.5.0",
    "firebase-functions-test": "^3.1.0"
  },
  "private": true
}
[debug] [2026-01-05T18:41:33.526Z] Building nodejs source
[debug] [2026-01-05T18:41:33.526Z] Failed to find version of module node: reached end of search path C:\Users\Sam\Nature_Steel\Nature_Steel\functions\node_modules
[warn] !  functions: Your requested "node" version "20" doesn't match your global version "22". Using node@22 from host. 
[info] i  functions: Loaded environment variables from .env.local. 
[debug] [2026-01-05T18:41:33.529Z] Could not find functions.yaml. Must use http discovery
[debug] [2026-01-05T18:41:33.537Z] Found firebase-functions binary at 'C:\Users\Sam\Nature_Steel\Nature_Steel\functions\node_modules\.bin\firebase-functions'
[info] Serving at port 8779

[debug] [2026-01-05T18:41:33.998Z] Got response from /__/functions.yaml {"endpoints":{"getSquarePublicConfig":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","secretEnvironmentVariables":[{"key":"SQUARE_APPLICATION_ID"},{"key":"SQUARE_LOCATION_ID"},{"key":"SQUARE_ENVIRONMENT"}],"labels":{},"callableTrigger":{},"entryPoint":"getSquarePublicConfig"},"createPayment":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","secretEnvironmentVariables":[{"key":"SQUARE_ACCESS_TOKEN"}],"labels":{},"callableTrigger":{},"entryPoint":"createPayment"},"createSquareCheckoutLink":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","secretEnvironmentVariables":[{"key":"SQUARE_ACCESS_TOKEN"},{"key":"SQUARE_ENVIRONMENT"},{"key":"SQUARE_LOCATION_ID"},{"key":"SQUARE_APPLICATION_ID"}],"labels":{},"callableTrigger":{},"entryPoint":"createSquareCheckoutLink"},"processSquarePayment":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","secretEnvironmentVariables":[{"key":"SQUARE_ACCESS_TOKEN"},{"key":"SQUARE_ENVIRONMENT"}],"labels":{},"callableTrigger":{},"entryPoint":"processSquarePayment"},"squareWebhook":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","secretEnvironmentVariables":[{"key":"SQUARE_WEBHOOK_SECRET"}],"labels":{},"httpsTrigger":{},"entryPoint":"squareWebhook"},"squareDiagnostics":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","secretEnvironmentVariables":[{"key":"SQUARE_ACCESS_TOKEN"},{"key":"SQUARE_ENVIRONMENT"}],"labels":{},"callableTrigger":{},"entryPoint":"squareDiagnostics"},"getOrderStatus":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","labels":{},"callableTrigger":{},"entryPoint":"getOrderStatus"},"cleanupPendingOrders":{"availableMemoryMb":null,"timeoutSeconds":null,"minInstances":null,"maxInstances":null,"ingressSettings":null,"concurrency":null,"serviceAccountEmail":null,"vpc":null,"platform":"gcfv2","labels":{},"scheduleTrigger":{"schedule":"every 24 hours","retryConfig":{"retryCount":null,"maxDoublings":null,"maxRetrySeconds":null,"minBackoffSeconds":null,"maxBackoffSeconds":null},"timeZone":null},"entryPoint":"cleanupPendingOrders"}},"specVersion":"v1alpha1","requiredAPIs":[{"api":"cloudscheduler.googleapis.com","reason":"Needed for scheduled functions."}],"extensions":{},"params":[{"type":"secret","name":"SQUARE_ACCESS_TOKEN"},{"type":"secret","name":"SQUARE_APPLICATION_ID"},{"type":"secret","name":"SQUARE_LOCATION_ID"},{"type":"secret","name":"SQUARE_ENVIRONMENT"},{"type":"secret","name":"SQUARE_WEBHOOK_SECRET"}]}
[debug] [2026-01-05T18:41:38.054Z] [functions] Loaded functions definitions from source: getSquarePublicConfig, createPayment, createSquareCheckoutLink, processSquarePayment, squareWebhook, squareDiagnostics, getOrderStatus, cleanupPendingOrders.
[debug] [2026-01-05T18:41:38.054Z] [functions[us-central1-getSquarePublicConfig]] http function initialized (http://127.0.0.1:5000/nature-and-steel/us-central1/getSquarePublicConfig).
[debug] [2026-01-05T18:41:38.055Z] [functions[us-central1-createPayment]] http function initialized (http://127.0.0.1:5000/nature-and-steel/us-central1/createPayment).
[debug] [2026-01-05T18:41:38.055Z] [functions[us-central1-createSquareCheckoutLink]] http function initialized (http://127.0.0.1:5000/nature-and-steel/us-central1/createSquareCheckoutLink).
[debug] [2026-01-05T18:41:38.055Z] [functions[us-central1-processSquarePayment]] http function initialized (http://127.0.0.1:5000/nature-and-steel/us-central1/processSquarePayment).
[debug] [2026-01-05T18:41:38.055Z] [functions[us-central1-squareWebhook]] http function initialized (http://127.0.0.1:5000/nature-and-steel/us-central1/squareWebhook).
[debug] [2026-01-05T18:41:38.055Z] [functions[us-central1-squareDiagnostics]] http function initialized (http://127.0.0.1:5000/nature-and-steel/us-central1/squareDiagnostics).
[debug] [2026-01-05T18:41:38.055Z] [functions[us-central1-getOrderStatus]] http function initialized (http://127.0.0.1:5000/nature-and-steel/us-central1/getOrderStatus).
[debug] [2026-01-05T18:41:38.055Z] [functions[us-central1-cleanupPendingOrders]] function ignored because the pubsub emulator does not exist or is not running.
[info] i  functions: Loaded functions: getSquarePublicConfig, createPayment, createSquareCheckoutLink, processSquarePayment, squareWebhook, squareDiagnostics, getOrderStatus, cleanupPendingOrders 
[warn] !  functions: The following emulators are not running, calls to these services will affect production: firestore, database, pubsub, storage, eventarc, tasks 
[debug] [2026-01-05T18:41:51.251Z] shell:cleanupPendingOrders: trigger={"entryPoint":"cleanupPendingOrders","platform":"gcfv2","region":"us-central1","name":"cleanupPendingOrders","id":"us-central1-cleanupPendingOrders","codebase":"default","availableMemoryMb":256,"labels":{"EVENTARC_CLOUD_EVENT_SOURCE":"run-emulated.googleapis.com/projects/nature-and-steel/locations/us-central1/services/cleanupPendingOrders"},"timeoutSeconds":60,"secretEnvironmentVariables":[],"eventTrigger":{"eventType":"pubsub","resource":""},"schedule":{"schedule":"every 24 hours","timeZone":null,"retryConfig":{"maxBackoffSeconds":null,"minBackoffSeconds":null,"maxRetrySeconds":null,"retryCount":null,"maxDoublings":null}}}
[debug] [2026-01-05T18:41:51.251Z] shell:cleanupPendingOrders: opts={}, data={}
[info] i  functions: Loaded environment variables from .env.local. 
[debug] [2026-01-05T18:41:51.261Z] DEBUG: [worker-pool] addWorker(us-central1-cleanupPendingOrders)
[debug] [2026-01-05T18:41:51.262Z] DEBUG: [worker-pool] Adding worker with key us-central1-cleanupPendingOrders, total=1
[debug] [2026-01-05T18:41:52.239Z] DEBUG: [runtime-status] [5812] Resolved module firebase-admin {"declared":true,"installed":true,"version":"12.7.0","resolution":"C:\\Users\\Sam\\Nature_Steel\\Nature_Steel\\functions\\node_modules\\firebase-admin\\lib\\index.js"}
[debug] [2026-01-05T18:41:52.240Z] DEBUG: [runtime-status] [5812] Resolved module firebase-functions {"declared":true,"installed":true,"version":"7.0.2","resolution":"C:\\Users\\Sam\\Nature_Steel\\Nature_Steel\\functions\\node_modules\\firebase-functions\\lib\\v2\\index.js"}
[debug] [2026-01-05T18:41:52.240Z] DEBUG: [runtime-status] [5812] Outgoing network have been stubbed. [{"name":"http","status":"mocked"},{"name":"http","status":"mocked"},{"name":"https","status":"mocked"},{"name":"https","status":"mocked"},{"name":"net","status":"mocked"}]
[debug] [2026-01-05T18:41:52.241Z] DEBUG: [runtime-status] [5812] Resolved module firebase-functions {"declared":true,"installed":true,"version":"7.0.2","resolution":"C:\\Users\\Sam\\Nature_Steel\\Nature_Steel\\functions\\node_modules\\firebase-functions\\lib\\v2\\index.js"}
[warn] !  functions: functions.config() has been removed in firebase-functions v7. Migrate to environment parameters using the params module. Migration guide: https://firebase.google.com/docs/functions/config-env#migrate-config {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-cleanupPendingOrders"},"extension":{},"message":"functions.config() has been removed in firebase-functions v7. Migrate to environment parameters using the params module. Migration guide: https://firebase.google.com/docs/functions/config-env#migrate-config"}}
[warn] !  Your function was killed because it raised an unhandled error. {"metadata":{"emulator":{"name":"functions"},"function":{"name":"us-central1-cleanupPendingOrders"},"extension":{},"message":"Your function was killed because it raised an unhandled error."}}
[debug] [2026-01-05T18:41:52.598Z] DEBUG: [worker-us-central1-cleanupPendingOrders-ead77f6c-4843-45bf-b17b-f71e9d481fb3]: exited
[debug] [2026-01-05T18:41:52.598Z] DEBUG: [worker-us-central1-cleanupPendingOrders-ead77f6c-4843-45bf-b17b-f71e9d481fb3]: FINISHED
[error] !!  functions: Failed to start runtime for us-central1-cleanupPendingOrders: FirebaseError: Failed to load function. {"metadata":{"emulator":{"name":"functions"},"message":"Failed to start runtime for us-central1-cleanupPendingOrders: FirebaseError: Failed to load function."}}
